import{c as v,u as P,a as S,r as h,j as s,R as C,N as p,C as x,B as R,b as c}from"./index-CqonvCgs.js";import{c as T,a as u,d as k,l as I,F,b as w,A as B}from"./index-Dtd34VlA.js";import{l as L}from"./logo-BPvrImub.js";import{R as g,C as o}from"./Row-kCx33sI5.js";import{F as n,a as j}from"./Form-BsIrG47u.js";import"./CloseButton-CRqNhKfH.js";import"./setPrototypeOf-DgZC2w_0.js";const G=()=>{const{token:d}=v(),i=P();S();const[f,b]=h.useState("");h.useEffect(()=>{(async()=>{try{const a=await(await fetch("http://localhost:5000/api/auth/verify-reset-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:d})})).json();a.valid?b(a.email):(c.error("Session Timed Out or Invalid URL"),setTimeout(()=>{i("/auth/signin")},2e3))}catch{c.error("Invalid or expired token"),setTimeout(()=>{i("/auth/signin")},2e3)}})()},[d,i]);const y=T().shape({password:u().min(8,"Password must be at least 8 characters").required("Password is required"),cpassword:u().oneOf([k("password"),null],"Passwords must match").required("Confirm Password is required")}),N=async(e,{setSubmitting:t,setErrors:a})=>{console.log(e);try{const r=await fetch("http://localhost:5000/api/auth/resetpassword",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f,password:e.password,cpassword:e.cpassword})}),l=await r.json();r.ok?(c.success(l.msg),setTimeout(()=>{i("/auth/signin")},2e3)):a({submit:l.message||"Login failed"})}catch{a({submit:"Server error. Please try again later."})}t(!1)};return s.jsx(C.Fragment,{children:s.jsx("div",{className:"auth-wrapper",children:s.jsxs(g,{className:"auth-row",children:[s.jsxs(o,{sm:12,md:6,className:"image p-0",children:[s.jsx("img",{src:I,alt:"Login",loading:"lazy",width:"600",height:"400"}),s.jsx("div",{className:"copyright_form",children:s.jsxs("p",{children:["Copyright Â© ",new Date().getFullYear()," Dev Panel. All Rights Reserved. Powered By:"," ",s.jsx(p,{to:"https://www.digihost.in/",target:"_blank",children:"DigiHost Tech Solutions Pvt. Ltd."})]})})]}),s.jsx(o,{sm:12,md:6,className:"col-12 auth-content",children:s.jsx(x,{className:"borderless d-flex align-items-center justify-content-center",children:s.jsxs(x.Body,{children:[s.jsx("div",{className:"",children:s.jsxs("div",{className:"mb-4 text-center",children:[s.jsx("div",{className:"logo",children:s.jsx("img",{src:L,alt:"Logo",width:"200",height:"50"})}),s.jsx("h5",{className:"mt-1",children:"Welcome Back!"}),s.jsx("p",{children:"Reset Your Password."})]})}),s.jsx(F,{initialValues:{password:"",cpassword:""},validationSchema:y,onSubmit:N,children:({errors:e,handleBlur:t,handleChange:a,handleSubmit:r,isSubmitting:l,touched:m,values:O})=>s.jsxs("form",{noValidate:!0,onSubmit:r,children:[s.jsxs(n.Group,{className:"mb-3",controlId:"old-password",children:[s.jsx(j,{controlId:"floatingInput",label:"New Password",className:"mb-3",children:s.jsx(n.Control,{type:"text",placeholder:"New Password",onBlur:t,onChange:a,name:"password"})}),m.password&&e.password&&s.jsxs("small",{className:"text-danger form-text d-flex justify-content-start align-items-center gap-1",children:[s.jsx(w,{})," ",e.password]})]}),s.jsxs(n.Group,{className:"mb-3",controlId:"new-password",children:[s.jsx(j,{controlId:"floatingInput",label:"Confirm Password",className:"mb-3",children:s.jsx(n.Control,{type:"text",placeholder:"Confirm Password",onBlur:t,onChange:a,name:"cpassword"})}),m.cpassword&&e.cpassword&&s.jsxs("small",{className:"text-danger form-text d-flex justify-content-start align-items-center gap-1",children:[s.jsx(w,{})," ",e.cpassword]})]}),s.jsxs(g,{className:"mt-4",children:[e.submit&&s.jsx(o,{sm:12,children:s.jsx(B,{children:e.submit})}),s.jsx(o,{sm:12,mt:1,children:s.jsx(R,{className:"btn-block",color:"primary",size:"large",type:"submit",variant:"primary",children:"Reset"})}),s.jsx(o,{sm:12,mt:2,children:s.jsx("div",{className:"below-text mt-3 text-center",children:s.jsxs("p",{className:"mb-4",children:["Don't have an account ?"," ",s.jsx(p,{to:"#",children:"Register"})," "]})})})]})]})})]})})})]})})})};export{G as default};
